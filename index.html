<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VACLEAN - Your Cleaning Experts</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #062f06;
      color: white;
      text-align: center;
      padding: 10px 0;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .menu-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 20px;
      background-color: #062f06;
      color: white;
      border: none;
      cursor: pointer;
      padding: 10px;
    }

    #sidebar {
      width: 250px;
      position: fixed;
      top: 60px;
      left: -250px;
      background-color: rgba(0, 0, 0, 0.8);
      overflow-x: hidden;
      transition: 0.3s;
      color: white;
      padding-top: 5px;
      z-index: 999;
    }

    #sidebar.active { left: 0; }

    #sidebar .content { padding: 20px; }

    #sidebar button {
      display: block;
      width: 100%;
      padding: 12px 16px;
      margin: 5px 0;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #F5DEB3;
      color: black;
    }

    #sidebar button:nth-of-type(6) { background-color: #808080; margin-top: 55px; }
    #sidebar button:nth-of-type(7) { background-color: #FF0000; margin-top: 5px; }

    .service-images {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .service-images img {
      width: 300px;
      height: 200px;
      object-fit: cover;
      border-radius: 10px;
    }

    .page-section {
      padding: 20px;
      display: none;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 500px;
    }

    input, textarea, select {
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button[type="submit"] {
      background-color: #062f06;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
    }

    #profile-pic {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: #4CAF50;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      margin: 0 auto 10px;
      overflow: hidden;
    }

    #profile-pic img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>
</head>
<body>

<!-- Sidebar -->
<div id="sidebar">
  <div class="content">
    <div id="user-profile">
      <div id="profile-pic">VACLEAN</div>
      <p><strong>Name:</strong> <span id="user-name">Loading...</span></p>
      <p><strong>Email:</strong> <span id="user-email">Loading...</span></p>
      <p><strong>Joined:</strong> <span id="user-date">Loading...</span></p>
    </div>
    <hr />
    <button onclick="showSection('services')">SERVICES</button>
    <button onclick="showSection('booking')">BOOKING</button>
    <button onclick="showSection('reviews')">REVIEWS</button>
    <button onclick="showSection('about')">ABOUT</button>
    <button onclick="showSection('contact')">CONTACT</button>
    <button onclick="goToAdmin()">ADMIN</button>
    <button onclick="logout()">LOG OUT</button>
  </div>
</div>

<!-- Header -->
<header>
  <button class="menu-btn" id="menu-btn">☰</button>
  <h1>VACLEAN</h1>
</header>

<!-- Service Images -->
<div class="service-images" id="service-images"></div>

<!-- Page Sections -->
<div id="services" class="page-section">
  <h2>Our Services</h2>
  <p>We offer home, office, and deep cleaning. Choose what suits you best!</p>
</div>

<div id="booking" class="page-section">
  <h2>Book a Cleaning Service</h2>
  <form id="bookingForm">
    <input type="text" name="name" placeholder="Full Name" required />
    <input type="email" name="email" placeholder="Email Address" required />
    <input type="tel" name="phone" placeholder="Phone Number" required />
    <input type="date" name="date" required />
    <input type="time" name="time" required />
    <select name="service" required>
      <option value="">-- Select Service --</option>
      <option value="home">Home Cleaning</option>
      <option value="office">Office Cleaning</option>
      <option value="deep">Deep Cleaning</option>
    </select>
    <textarea name="notes" placeholder="Additional Notes (optional)" rows="4"></textarea>
    <button type="submit">Submit Booking</button>
  </form>
</div>

<!-- Reviews Section -->
  <!-- Reviews Section -->
  <div id="reviewsSection" class="content-section" style="padding-top: 34px; background-color: black; color: white;">

  <div id="reviewFormContainer" style="
    max-width: 500px;
    margin: 10px auto 20px auto;
    background-color: #6A0DAD;
    padding: 5px;
    border-radius: 10px;
    color: black;">
    
    <form id="reviewForm" style="text-align: center;">
      <input type="text" id="reviewName" placeholder="Your Name" required
        style="width: 100%; padding: 8px; margin-bottom: 6px; border-radius: 6px; border: 1px solid #555; background-color: #fff; color: black; box-sizing: border-box;" />

      <textarea id="reviewComment" placeholder="Write your review..." required
        style="width: 100%; height: 60px; padding: 8px; margin-bottom: 6px; border-radius: 6px; border: 1px solid #555; background-color: #fff; color: black; box-sizing: border-box;"></textarea>

      <div id="starRating" style="font-size: 22px; margin-bottom: 6px; cursor: pointer; color: #ccc; letter-spacing: -2px;">
        <span data-value="1">★</span><span data-value="2">★</span><span data-value="3">★</span><span data-value="4">★</span><span data-value="5">★</span>
      </div>

      <button type="submit" style="background-color: #6200ea; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
        Submit Review
      </button>
    </form>
  </div>

  <h1 style="text-align: center; color: #9b59b6; margin-top: 5px; margin-bottom: 10px;">REVIEWS</h1>

  <p id="reviewSubmitMsg" style="text-align: center; color: #7fff7f; margin-top: 0;"></p>

  <div id="reviewsContainer" style="max-width: 600px; margin: 0 auto; color: white;"></div>
  </div>

<div id="about" class="page-section">
  <h2>About VACLEAN</h2>
  <p>VACLEAN is a trusted cleaning service in your community, known for reliability and quality.</p>
</div>

<div id="contact" class="page-section">
  <h2>Contact Us</h2>
  <p>Email: support@vaclean.com</p>
  <p>Phone: (876) 555-1234</p>
</div>
<!-- Firebase SDK + Section Toggle Script -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
  import { getStorage, ref, listAll, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB6xsThcLLRYHkWdWYlR4CwVQ8lqnMdS6o",
    authDomain: "vaclean-4ce0f.firebaseapp.com",
    databaseURL: "https://vaclean-4ce0f-default-rtdb.firebaseio.com",
    projectId: "vaclean-4ce0f",
    storageBucket: "vaclean-4ce0f.appspot.com",
    messagingSenderId: "749048496535",
    appId: "1:749048496535:web:21ff28bce2c7713e3804d2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const storage = getStorage(app);

  const menuBtn = document.getElementById("menu-btn");
  const sidebar = document.getElementById("sidebar");

  menuBtn.addEventListener("click", () => {
    sidebar.classList.toggle("active");
  });

  window.closeSidebar = function () {
    sidebar.classList.remove("active");
  };

  window.addEventListener("click", function (event) {
    if (!sidebar.contains(event.target) && !menuBtn.contains(event.target)) {
      closeSidebar();
    }
  });

  onAuthStateChanged(auth, user => {
    const profilePicDiv = document.getElementById("profile-pic");

    if (user) {
      document.getElementById("user-name").textContent = user.displayName || "No Name";
      document.getElementById("user-email").textContent = user.email;
      const joined = new Date(user.metadata.creationTime);
      document.getElementById("user-date").textContent = joined.toDateString();

      if (user.photoURL) {
        profilePicDiv.innerHTML = `<img src="${user.photoURL}" alt="Profile">`;
      } else {
        profilePicDiv.textContent = "VACLEAN";
      }
    }
  });

  const serviceImagesDiv = document.getElementById('service-images');
  const storageRef = ref(storage, 'service_images');

  listAll(storageRef).then((result) => {
    result.items.forEach((imageRef) => {
      getDownloadURL(imageRef).then((url) => {
        const img = document.createElement('img');
        img.src = url;
        serviceImagesDiv.appendChild(img);
      });
    });
  });

  window.goToAdmin = function () {
    const inputEmail = prompt("Enter admin email:");
    const inputPassword = prompt("Enter admin password:");

    if (inputEmail === "carlanviroberts@gmail.com" && inputPassword === "@Carlanvi321") {
      window.location.href = "dashboard.html";
    }
  };

  window.logout = function () {
    signOut(auth).then(() => {
      window.location.href = "login.html";
    });
  };
</script>

<script>
  function showSection(id) {
    const sections = document.querySelectorAll('.page-section');
    sections.forEach(sec => sec.style.display = 'none');
    document.getElementById(id).style.display = 'block';
    closeSidebar();
  }

  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("bookingForm");
    if (form) {
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        alert("Booking submitted!");
        form.reset();
      });
    }

    // Handle star rating UI
document.querySelectorAll('#starRating span').forEach(star => {
  star.addEventListener('click', () => {
    selectedRating = parseInt(star.getAttribute('data-value'));  // Set rating value on click
    // Update star colors based on selection
    document.querySelectorAll('#starRating span').forEach(s => {
      s.style.color = parseInt(s.getAttribute('data-value')) <= selectedRating ? '#f39c12' : '#ccc';
    });
  });
});

// Handle review form submission
document.getElementById('reviewForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const user = firebase.auth().currentUser;
  if (!user) {
    alert("You must be logged in to submit a review.");
    return;
  }

  const name = document.getElementById('reviewName').value.trim();
  const comment = document.getElementById('reviewComment').value.trim();
  const msg = document.getElementById('reviewSubmitMsg');

  // Check for required fields and star rating
  if (!name || !comment || selectedRating === 0) {
    msg.style.color = "red";
    msg.textContent = "Please fill all fields and select a star rating.";
    return;
  }

  try {
    // Add the review to Firestore
    await db.collection('reviews').add({
      name,
      comment,
      rating: selectedRating,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      uid: user.uid
    });

    // Update UI message and reset fields
    msg.style.color = "green";
    msg.textContent = "Thank you for your review!";
    document.getElementById('reviewForm').reset();
    selectedRating = 0;
    document.querySelectorAll('#starRating span').forEach(s => s.style.color = '#ccc');

    // Refresh reviews immediately after submission
    loadReviews(user);

  } catch (error) {
    console.error("Error submitting review:", error);
    msg.style.color = "red";
    msg.textContent = "Error submitting review.";
  }
});

// Function to load and display reviews
function loadReviews(user) {
  const container = document.getElementById('reviewsContainer');
  container.innerHTML = ''; // Clear any existing reviews

  db.collection('reviews').orderBy('timestamp', 'desc').get().then(snapshot => {
    if (snapshot.empty) {
      container.innerHTML = '<p>No reviews yet.</p>';
      return;
    }

    snapshot.forEach(doc => {
      const data = doc.data();
      const canDelete = user && data.uid === user.uid; // Check if the logged-in user can delete the review

      const reviewDiv = document.createElement('div');
      reviewDiv.style.borderBottom = '1px solid #ddd';
      reviewDiv.style.padding = '10px 0';

      // Display stars based on the rating
      const stars = '★'.repeat(data.rating) + '☆'.repeat(5 - data.rating);

      reviewDiv.innerHTML = `
        <strong>${data.name}</strong> <span style="color: #f39c12;">${stars}</span><br/>
        <p>${data.comment}</p>
      `;

      // Add delete button if the user can delete the review
      if (canDelete) {
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.style.backgroundColor = '#e74c3c';
        delBtn.style.color = 'white';
        delBtn.style.border = 'none';
        delBtn.style.padding = '5px 10px';
        delBtn.style.borderRadius = '4px';
        delBtn.style.cursor = 'pointer';

        delBtn.addEventListener('click', () => deleteReview(doc.id)); // Add delete logic

        reviewDiv.appendChild(delBtn); // Append the delete button
      }

      container.appendChild(reviewDiv);
    });
  }).catch(error => {
    console.error('Error loading reviews:', error);
    container.innerHTML = '<p>Error loading reviews.</p>';
  });
}

// Function to delete review
function deleteReview(docId) {
  const user = firebase.auth().currentUser;
  if (!user) {
    alert('You must be logged in to delete reviews.');
    return;
  }

  if (confirm("Are you sure you want to delete this review?")) {
    db.collection('reviews').doc(docId).get().then(doc => {
      if (doc.exists && doc.data().uid === user.uid) {
        db.collection('reviews').doc(docId).delete()
          .then(() => {
            alert('Review deleted.');
            loadReviews(user); // Reload reviews after deletion
          })
          .catch(error => {
            alert('Error deleting review: ' + error.message);
          });
      } else {
        alert("You can only delete your own reviews.");
      }
    });
  }
}
</script>

</body>
</html>
